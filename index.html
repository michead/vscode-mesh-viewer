<!DOCTYPE html>
<html>
  <head>
    <script id="mesh-preview-vert-shader" type="x-shader/x-vertex">
      attribute vec3 position;
      attribute vec3 normal;
      attribute vec2 texCoord;
      uniform mat4 modelMat;
      uniform mat4 viewMat;
      uniform mat4 projMat;
      varying vec3 worldPos;
      varying vec3 worldNormal;
      varying vec2 fragTexCoord;
      void main(void) {
        gl_Position = projMat * viewMat * modelMat * vec4(position, 1.0);
        vec4 worldPos4 = modelMat * vec4(position, 1);
        worldPos = worldPos4.xyz / worldPos4.w;
        worldNormal = normal;
        fragTexCoord = texCoord;
      }
    </script>
    <script id="mesh-preview-frag-shader" type="x-shader/x-fragment">
      precision mediump float;
      uniform vec3 lightPos;
      uniform vec3 ka;
      uniform vec3 kd;
      uniform vec3 ks;
      uniform float ns;
      uniform bool bKdMap;
      uniform sampler2D kdMap;
      varying vec3 worldPos;
      varying vec3 worldNormal;
      varying vec2 fragTexCoord;
      void main(void) {
        vec3 normal = normalize(worldNormal);
        vec3 lightDir = normalize(lightPos - worldPos);
        float lambertian = dot(lightDir, normal);
        if (lambertian < 0.0) {
          lambertian = 0.0;
        }
        float specular = 0.0;
        if (lambertian > 0.0) {
          vec3 viewDir = normalize(-worldPos);
          vec3 h = normalize(lightDir + viewDir);
          float r = dot(h, normal);
          if (r < 0.0) {
            r = 0.0;
          }
          specular = pow(r, ns);
        }
        vec3 diffuse = bKdMap ? texture2D(kdMap, fragTexCoord).rgb : kd;
        vec3 colorLinear = ka + lambertian * diffuse + specular * ks;
        gl_FragColor = vec4(colorLinear, 1.0);
      }
    </script>
    <script id="mesh-preview-vert-shader-hud" type="x-shader/x-vertex">
      attribute vec3 position;
      uniform mat4 modelMat;
      uniform mat4 viewMat;
      uniform mat4 projMat;
      void main(void) {
        gl_Position = projMat * viewMat * modelMat * vec4(position, 1.0);
      }
    </script>
    <script id="mesh-preview-frag-shader-hud" type="x-shader/x-fragment">
      precision mediump float;
      uniform vec4 color;
      void main(void) {
        gl_FragColor = color;
      }
    </script>
  </head>
  <body style="overflow:hidden;">
    <canvas id="mesh-preview-canvas"></canvas>
    <div id="mesh-preview-mtl" style="display:none;">
      ${materials}
    </div>
    <div id="mesh-preview-obj" style="display:none;">
      ${mesh}
    </div>
    ${images}
    <script type="text/javascript" src="file:///${outPath}/index.js"></script>
  </body>
</html>
